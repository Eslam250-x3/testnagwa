<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نشأة علم النفس وتطوره</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f7fafc;
            padding-top: 80px; 
            overflow-x: hidden; /* Prevent horizontal scroll on body due to potential swipe issues */
        }
        
        .slide {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
            min-height: 70vh; 
        }
        
        .slide.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .7; }
        }
        
        .highlight { 
            font-weight: 700; 
            color: #4f46e5; /* Indigo-600 for important words, no background */
        }
        
        .example-box {
            background-color: #f0fdf4;
            border-left: 4px solid #10b981; 
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .example-box:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .question-box {
            background-color: #eff6ff;
            border-left: 4px solid #3b82f6; 
            padding: 1.25rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .slide-header {
            padding: 1.5rem;
            color: white;
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
        }
        .slide-content {
            padding: 1.5rem; 
        }
        .icon-list li {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            padding: 0.35rem 0.5rem; 
            border-radius: 0.375rem; 
        }
        .icon-list li:hover {
            background-color: #eef2ff; 
            transform: translateX(-2px);
        }
        .icon-list .fa-circle, .icon-list .fas {
            margin-left: 0.75rem; 
            margin-top: 0.3rem; 
        }

        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 0.5rem 1rem;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px; 
        }

        .nav-thumbnails-container {
            display: flex;
            overflow-x: auto; 
            overflow-y: hidden;
            gap: 0.5rem; 
            flex-grow: 1;
            padding: 5px 0; 
            -webkit-overflow-scrolling: touch; 
            direction: ltr; 
        }
        .nav-thumbnails-container::-webkit-scrollbar { height: 6px; }
        .nav-thumbnails-container::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .nav-thumbnails-container::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
        .nav-thumbnails-container::-webkit-scrollbar-thumb:hover { background: #aaa; }

        .nav-thumbnail {
            min-width: 60px; /* Adjusted for icon */
            width: 60px;    /* Adjusted for icon */
            height: 50px; 
            border: 2px solid #e5e7eb; 
            border-radius: 0.375rem; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem; 
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out; 
            background-color: #f9fafb; 
            padding: 0.25rem;
            overflow: hidden; 
            white-space: nowrap;
            text-overflow: ellipsis;
            flex-shrink: 0; 
            /* direction: rtl; /* Removed as icon itself is not RTL text */
        }
        .nav-thumbnail:hover {
            border-color: #6366f1; 
            background-color: #eef2ff; 
            transform: translateY(-2px);
        }
        .nav-thumbnail.active {
            border-color: #4338ca; 
            background-color: #e0e7ff; 
            color: #4338ca; 
            font-weight: bold;
            transform: scale(1.05) translateY(-1px);
        }
        .nav-thumbnail.locked {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #e5e7eb;
            border-color: #d1d5db;
        }
        .nav-thumbnail.locked:hover {
             transform: none;
             background-color: #e5e7eb;
        }
        .nav-thumbnail i { /* Style for icons in thumbnails */
            color: #4b5563; /* Default icon color (gray-600) */
            transition: color 0.2s ease-in-out;
        }
        .nav-thumbnail:hover i {
            color: #4f46e5; /* Indigo-600 on hover */
        }
        .nav-thumbnail.active i {
            color: #4338ca; /* Indigo-700 when active */
        }
        .nav-thumbnail.locked i {
            color: #6b7280; /* Gray-500 when locked */
        }
         .nav-thumbnail.locked:hover i {
            color: #6b7280; /* Gray-500 when locked and hovered */
        }


        .nav-arrows button {
            padding: 0.75rem; 
            border-radius: 9999px; 
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        .nav-arrows button:hover {
            background-color: #e5e7eb; 
        }
        .nav-arrows button:active {
            transform: scale(0.95);
        }
        .nav-arrows button:focus {
            outline: none;
            box-shadow: 0 0 0 2px #6366f1; 
        }

        .answer-btn {
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
        }
        .answer-btn:hover:not(.correct):not(.incorrect):not(.selected-temp) {
            background-color: #dbeafe !important; 
            border-color: #60a5fa !important; 
        }
        .answer-btn:active:not(.correct):not(.incorrect) {
            transform: scale(0.98);
        }
        .answer-btn.selected-temp { 
             background-color: #c7d2fe !important; 
             border-color: #818cf8 !important; 
        }
        .answer-btn.correct {
            background-color: #d1fae5 !important; 
            border-color: #10b981 !important; 
            color: #065f46 !important; 
            font-weight: bold;
        }
        .answer-btn.incorrect {
            background-color: #fee2e2 !important; 
            border-color: #ef4444 !important; 
            color: #991b1b !important; 
            font-weight: bold;
        }
        .ai-feedback {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #e0f2fe; 
            border-left: 4px solid #0ea5e9; 
            border-radius: 0.375rem;
            font-size: 0.9rem;
            line-height: 1.6;
            transition: opacity 0.3s ease-in-out;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3; 
            border-top: 4px solid #3498db; 
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .adaptive-test-timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #dc2626; 
            margin-bottom: 1rem;
            text-align: center;
            padding: 0.5rem;
            background-color: #fee2e2; 
            border-radius: 0.375rem;
        }
        .adaptive-test-timer.low-time {
            animation: pulse 1s infinite;
        }
        .adaptive-test-results {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: #f3e8ff; 
            border: 2px solid #a855f7; 
            border-radius: 0.5rem;
            text-align: center;
        }
        #slides-container {
            touch-action: pan-y; 
        }
        .next-slide-btn {
            display: none; 
            margin: 10px auto 0;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }

    </style>
</head>
<body class="bg-gray-100">
    <div class="top-nav">
        <div class="nav-arrows flex items-center space-x-2 space-x-reverse">
            <button id="prev-btn-top" class="text-indigo-600"> <i class="fas fa-arrow-right"></i> </button>
        </div>
        <div class="nav-thumbnails-container" id="nav-thumbnails">
            </div>
        <div class="nav-arrows flex items-center space-x-2 space-x-reverse">
            <button id="next-btn-top" class="text-indigo-600"> <i class="fas fa-arrow-left"></i> </button>
        </div>
    </div>

    <div id="slides-container" class="container mx-auto px-4 py-12 md:py-20 max-w-4xl">
        <div class="slide active bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="مقدمة" data-slide-category="مقدمة">
            <div class="slide-header bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500">
                <h1 class="text-3xl md:text-4xl font-bold">نشأة علم النفس وتطوره</h1>
            </div>
            <div class="slide-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h2 class="text-xl font-semibold text-indigo-700 mb-4 flex items-center"> <i class="fas fa-history ml-2 text-indigo-500"></i> المراحل التاريخية الرئيسية </h2>
                        <ul class="space-y-3 text-gray-700 icon-list">
                            <li><i class="fas fa-circle text-xs text-indigo-400"></i><span>المرحلة <span class="highlight">الفلسفية</span> (اليونانية القديمة)</span></li>
                            <li><i class="fas fa-circle text-xs text-indigo-400"></i><span>المرحلة <span class="highlight">الفسيولوجية</span></span></li>
                            <li><i class="fas fa-circle text-xs text-indigo-400"></i><span>مرحلة <span class="highlight">الاستقلال</span></span></li>
                        </ul>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-purple-700 mb-4 flex items-center"> <i class="fas fa-school ml-2 text-purple-500"></i> أبرز مدارس علم النفس </h2>
                        <ul class="space-y-3 text-gray-700 icon-list">
                            <li><i class="fas fa-shapes text-xs text-purple-400"></i><span>المدرسة <span class="highlight">البنائية</span></span></li>
                            <li><i class="fas fa-running text-xs text-purple-400"></i><span>المدرسة <span class="highlight">السلوكية</span></span></li>
                            <li><i class="fas fa-brain text-xs text-purple-400"></i><span>مدرسة <span class="highlight">التحليل النفسي</span></span></li>
                            <li><i class="fas fa-puzzle-piece text-xs text-purple-400"></i><span>مدرسة <span class="highlight">الجشطلت</span></span></li>
                            <li><i class="fas fa-lightbulb text-xs text-purple-400"></i><span>المدرسة <span class="highlight">المعرفية</span></span></li>
                        </ul>
                    </div>
                </div>
                <div class="mt-10 flex justify-center">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 inline-flex items-center shadow"> <i class="fas fa-info-circle text-blue-500 ml-2"></i> <span class="text-blue-700 font-medium">استخدم الأسهم، الصور المصغرة، أو السحب (على الموبايل) للتنقل.</span> </div>
                </div>
            </div>
        </div>

        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="نظرة موجزة" data-slide-category="مراحل تاريخية">
            <div class="slide-header bg-gradient-to-br from-sky-600 via-cyan-500 to-teal-400">
                <h1 class="text-3xl md:text-4xl font-bold">نظرة موجزة لنشأة علم النفس وتطوره</h1>
                <p class="mt-2 opacity-90 text-lg">الجذور التاريخية لعلم النفس</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-sky-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-hourglass-half text-sky-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg"> علم النفس هو علم من العلوم <span class="highlight">الحديثة نسبيًا</span>، له <span class="highlight">ماض طويل</span>، لكن <span class="highlight">تاريخه العلمي قصير</span>. </p>
                        <p class="text-gray-800 leading-relaxed mt-2 text-lg"> ظهر بمظهره العلمي الذي له موضوع واهتمامات محددة في <span class="highlight">الربع الأخير من القرن التاسع عشر</span>. </p>
                    </div>
                </div>
                <div class="bg-amber-50 p-5 rounded-lg shadow mb-6">
                    <h3 class="font-bold text-xl text-amber-700 mb-3 flex items-center"> <i class="fas fa-seedling ml-2 text-amber-600"></i> الجذور التاريخية لعلم النفس الحديث </h3>
                    <ul class="space-y-3 text-gray-700 icon-list text-lg">
                        <li> <i class="fas fa-landmark text-xs text-amber-500"></i> <span><span class="highlight">التراث الشرقي القديم</span> (<span class="highlight">الفرس</span> و<span class="highlight">الهنود</span>).</span> </li>
                        <li> <i class="fas fa-university text-xs text-amber-500"></i> <span><span class="highlight">بلاد اليونان</span> (<span class="highlight">الإغريق</span>) وفلاسفتهم الكبار، وخاصة <span class="highlight">سقراط</span> و<span class="highlight">أفلاطون</span> و<span class="highlight">أرسطو</span>.</span> </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="المرحلة الفلسفية" data-slide-category="مراحل تاريخية">
            <div class="slide-header bg-gradient-to-br from-purple-600 via-pink-500 to-red-500">
                <h1 class="text-3xl md:text-4xl font-bold">المرحلة الفلسفية (اليونانية القديمة)</h1>
                <p class="mt-2 opacity-90 text-lg">دراسة النفس والروح كبداية</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-purple-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-scroll text-purple-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg"> اهتمت بدراسة <span class="highlight">ماهية النفس</span> ومعرفة حقيقتها. </p>
                        <p class="text-gray-800 leading-relaxed mt-2 text-lg"> سميت هذه الدراسة من البداية باسم «<span class="highlight">علم النفس</span>». </p>
                    </div>
                </div>
                <div class="mb-6">
                    <h3 class="font-bold text-xl text-purple-700 mb-3 flex items-center"> <i class="fas fa-lightbulb ml-2 text-purple-600"></i> مفاهيم أساسية في هذه المرحلة </h3>
                    <ul class="space-y-3 text-gray-700 icon-list text-lg">
                        <li><i class="fas fa-link text-xs text-purple-500"></i><span>ارتبط علم النفس في هذه المرحلة بـ<span class="highlight">النفس أو الروح</span>.</span></li>
                        <li><i class="fas fa-fingerprint text-xs text-purple-500"></i><span>الروح في اعتقادهم هي <span class="highlight">مصدر السلوك</span>.</span></li>
                        <li><i class="fas fa-search-plus text-xs text-purple-500"></i><span>فسروا من خلال مفهوم النفس أو الروح <span class="highlight">بواعث السلوك</span> من أحلام وتفكير وحس وإدراك وحركة.</span></li>
                    </ul>
                </div>
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border-l-4 border-purple-300 shadow">
                    <h3 class="font-semibold text-purple-700 text-lg mb-2"><i class="fas fa-users ml-2"></i>أبرز الفلاسفة</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-2 text-center">
                        <div class="bg-white p-3 rounded-lg shadow-md hover:shadow-lg transition-shadow"><i class="fas fa-user-tie text-blue-500 text-2xl mb-1"></i><h4 class="font-bold text-blue-600">سقراط</h4></div>
                        <div class="bg-white p-3 rounded-lg shadow-md hover:shadow-lg transition-shadow"><i class="fas fa-user-graduate text-green-500 text-2xl mb-1"></i><h4 class="font-bold text-green-600">أفلاطون</h4></div>
                        <div class="bg-white p-3 rounded-lg shadow-md hover:shadow-lg transition-shadow"><i class="fas fa-book-open text-yellow-600 text-2xl mb-1"></i><h4 class="font-bold text-yellow-700">أرسطو</h4></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="المرحلة الفسيولوجية" data-slide-category="مراحل تاريخية">
            <div class="slide-header bg-gradient-to-br from-green-600 via-lime-500 to-emerald-400">
                <h1 class="text-3xl md:text-4xl font-bold">المرحلة الفسيولوجية</h1>
                <p class="mt-2 opacity-90 text-lg">التحول نحو العلم التجريبي</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-green-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-dna text-green-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg"> بدأ علم النفس <span class="highlight">يستقل فعليًا عن الفلسفة</span> ويرتبط بعلم <span class="highlight">الفسيولوجيا</span> (علم وظائف الأعضاء). </p>
                        <p class="text-gray-800 leading-relaxed mt-2 text-lg"> استفاد علم النفس من إمكانيات <span class="highlight">المنهج التجريبي</span> الذي كان مستخدمًا في هذه العلوم. </p>
                    </div>
                </div>
                <div class="flex items-center bg-sky-50 p-4 rounded-lg shadow mb-6 border-l-4 border-sky-300">
                    <div class="bg-sky-100 p-3 rounded-full ml-4 shadow-inner"> <i class="fas fa-user-md text-sky-600 text-2xl"></i> </div>
                    <div>
                        <h3 class="font-bold text-xl text-sky-700">ولهلم فونت</h3>
                        <p class="text-gray-700 text-lg"> من الرواد الأوائل الذين ساهموا في تحول علم النفس إلى المرحلة الفسيولوجية بفضل إسهاماته الرائدة. </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="إسهامات فونت" data-slide-category="مراحل تاريخية">
            <div class="slide-header bg-gradient-to-br from-amber-500 via-orange-500 to-red-500">
                <h1 class="text-3xl md:text-4xl font-bold">المرحلة الفسيولوجية: إسهامات فونت</h1>
                <p class="mt-2 opacity-90 text-lg">تأسيس علم النفس التجريبي</p>
            </div>
            <div class="slide-content">
                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold text-xl text-amber-700 mb-3 flex items-center"> <i class="fas fa-flask ml-2 text-amber-600"></i> أبرز إسهامات <span class="highlight">فونت</span> في مجال الدراسات النفسية: </h3>
                    <ul class="space-y-3 text-gray-700 icon-list text-lg">
                        <li><i class="fas fa-microscope text-xs text-amber-500"></i><span>أنشأ <span class="highlight">أول معمل لعلم النفس التجريبي</span> في العالم بجامعة ليبزج بألمانيا عام <span class="highlight">١٨٧٩م</span>.</span></li>
                        <li><i class="fas fa-brain text-xs text-amber-500"></i><span>كان الاهتمام فيه منصَبًا على إجراء <span class="highlight">تجارب نفس فسيولوجية</span> عن موضوعين مرتبطين ارتباطا واضحًا بالسلوك البشري، وهما <span class="highlight">الإحساس والإدراك</span>، بهدف دراسة <span class="highlight">عمليات التفكير أو الشعور</span>.</span></li>
                        <li><i class="fas fa-book-open text-xs text-amber-500"></i><span>أسس مجلة <span class="highlight">«الدراسات الفلسفية»</span> عام <span class="highlight">١٨٨١م</span>.</span></li>
                    </ul>
                </div>
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-lg border-l-4 border-amber-300 shadow">
                    <h3 class="font-semibold text-amber-700 text-lg"><i class="fas fa-award ml-2"></i>مكانة فونت</h3>
                    <p class="text-gray-700 mt-1 text-lg">يُعتبر <span class="highlight">فونت</span> "أب علم النفس التجريبي"، لدوره المحوري في تحويل دراسة النفس إلى علم قائم على التجربة والملاحظة الدقيقة.</p>
                </div>
            </div>
        </div>

        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="محاور بحوث فونت" data-slide-category="مراحل تاريخية">
            <div class="slide-header bg-gradient-to-br from-rose-500 via-pink-500 to-fuchsia-500">
                <h1 class="text-3xl md:text-4xl font-bold">المرحلة الفسيولوجية: محاور البحوث</h1>
                <p class="mt-2 opacity-90 text-lg">مجالات البحث في معمل فونت</p>
            </div>
            <div class="slide-content">
                <p class="text-gray-800 leading-relaxed text-lg mb-4"> تركزت البحوث التجريبية في معمل «فونت» التجريبي على ثلاثة محاور رئيسية هي: </p>
                <div class="space-y-4">
                    <div class="example-box border-l-4 border-rose-400 bg-rose-50">
                        <h4 class="font-bold text-lg text-rose-700 mb-2 flex items-center"><i class="fas fa-hand-pointer ml-2"></i> <span class="highlight">عمليات الإدراك الحسي</span></h4>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 text-md">
                            <li>لمس سطح ما (منبه حسي) يتم إدراكه على أنه ناعم، خشن، بارد ساخن، إلخ.</li>
                            <li>رؤية لوحة فنية (منبه حسي) يتم إدراكها على أنها ألوان زاهية، أشكال هندسية، منظر طبيعي، إلخ.</li>
                        </ul>
                    </div>
                    <div class="example-box border-l-4 border-pink-400 bg-pink-50">
                        <h4 class="font-bold text-lg text-pink-700 mb-2 flex items-center"><i class="fas fa-heartbeat ml-2"></i> <span class="highlight">الطبيعة النفسية</span></h4>
                        <p class="text-gray-700 mb-1 text-md">وهي أحد فروع علم النفس التي تهتم بدراسة العلاقة بين المثيرات الحسية والاستجابات أو ردود الأفعال الناتجة عنها.</p>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 text-md">
                            <li>دراسة العلاقة بين درجة حرارة الغرفة وشعور الشخص بالراحة.</li>
                            <li>متابعة رد فعل الشخص عند سماع موسيقى صاخبة (الانزعاج أو الحماس).</li>
                        </ul>
                    </div>
                    <div class="example-box border-l-4 border-fuchsia-400 bg-fuchsia-50">
                        <h4 class="font-bold text-lg text-fuchsia-700 mb-2 flex items-center"><i class="fas fa-stopwatch ml-2"></i> <span class="highlight">دراسة زمن الرجع</span></h4>
                        <p class="text-gray-700 mb-1 text-md">وهو الفاصل الزمني الذي يفصل بين ظهور المثير وحدوث الاستجابة.</p>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 text-md">
                            <li>الوقت بين رؤية إشارة المرور الحمراء والضغط على فرامل السيارة.</li>
                            <li>المدة بين سماع صافرة البداية وانطلاق العداء في سباق.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="مرحلة الاستقلال" data-slide-category="مراحل تاريخية" id="historical-stages-end">
            <div class="slide-header bg-gradient-to-br from-blue-600 via-indigo-500 to-violet-500">
                <h1 class="text-3xl md:text-4xl font-bold">مرحلة الاستقلال</h1>
                <p class="mt-2 opacity-90 text-lg">علم النفس كعلم مستقل بذاته</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-indigo-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-flag-checkered text-indigo-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg"> عارض بعض العلماء ارتباط علم النفس بعلم الفسيولوجيا، وعلم البيولوجيا. </p>
                        <p class="text-gray-800 leading-relaxed mt-2 text-lg"> ظهرت بعض الحجج القوية التي كان لها أثر عميق بعد ذلك في <span class="highlight">استقلال علم النفس موضوعًا ومنهجًا</span>. </p>
                    </div>
                </div>
                <div class="mb-6 p-4 bg-violet-50 rounded-lg border-l-4 border-violet-300">
                    <h3 class="font-bold text-xl text-violet-700 mb-3 flex items-center"> <i class="fas fa-microscope ml-2 text-violet-600"></i> خصائص مرحلة الاستقلال: </h3>
                    <ul class="space-y-3 text-gray-700 icon-list text-lg">
                        <li><i class="fas fa-eye text-xs text-violet-500"></i><span>أصبح موضوع علم النفس هو <span class="highlight">السلوك الظاهري</span>.</span></li>
                        <li><i class="fas fa-vial text-xs text-violet-500"></i><span>أصبح منهجه هو <span class="highlight">الملاحظة والتجربة</span>.</span></li>
                    </ul>
                </div>
                <h4 class="font-bold text-lg text-gray-700 mb-2">أمثلة توضيحية:</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="example-box"><p><i class="fas fa-users ml-1 text-green-600"></i> دراسة أسباب تفضيل بعض الطلاب للدراسة الفردية بدلا من الجماعية من خلال استبيانات وملاحظات سلوكية.</p></div>
                    <div class="example-box"><p><i class="fas fa-flask ml-1 text-green-600"></i> قام الباحث «سكينر» بدراسة عملية التعلم عند الحيوانات باستخدام التجارب المعملية؛ مما أدى إلى تطوير نظرية التعلم بالتعزيز.</p></div>
                    <div class="example-box col-span-1 md:col-span-2"><p><i class="fas fa-mobile-alt ml-1 text-green-600"></i> فهم ظاهرة إدمان وسائل التواصل الاجتماعي من خلال دراسة أنماط استخدام الهواتف الذكية وتأثيرها على السلوك اليومي للأفراد.</p></div>
                </div>
            </div>
        </div>
        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="المدرسة البنائية" data-slide-category="مدارس علم النفس">
            <div class="slide-header bg-gradient-to-br from-yellow-500 via-amber-500 to-orange-600">
                <h1 class="text-3xl md:text-4xl font-bold">المدرسة البنائية</h1>
                <p class="mt-2 opacity-90 text-lg">دراسة الخبرة الداخلية الشعورية</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-amber-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-cubes text-amber-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg">أسسها «<span class="highlight">فونت</span>» وأشهر تلاميذه «<span class="highlight">تشنير</span>».</p>
                        <p class="text-gray-800 leading-relaxed mt-1 text-lg">حددت موضوع علم النفس في دراسة <span class="highlight">الخبرة الداخلية الشعورية المباشرة</span> للفرد.</p>
                    </div>
                </div>
                <h3 class="font-bold text-xl text-amber-700 mb-3 flex items-center"><i class="fas fa-quote-left ml-2 text-amber-600"></i> أمثلة على الخبرة الداخلية الشعورية:</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="example-box border-l-4 border-yellow-400 bg-yellow-50"><p><i class="fas fa-smile-beam ml-1 text-yellow-600"></i> شعور الفرد بالسعادة عندما ينجح في الامتحان.</p></div>
                    <div class="example-box border-l-4 border-red-400 bg-red-50"><p><i class="fas fa-angry ml-1 text-red-600"></i> الشعور بالغضب عند التعرض للإهانة.</p></div>
                    <div class="example-box border-l-4 border-green-400 bg-green-50"><p><i class="fas fa-couch ml-1 text-green-600"></i> الإحساس بالراحة والاسترخاء بعد يوم عمل شاق.</p></div>
                    <div class="example-box border-l-4 border-purple-400 bg-purple-50"><p><i class="fas fa-question ml-1 text-purple-600"></i> الخوف من المستقبل المجهول.</p></div>
                </div>
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-4 rounded-lg border-l-4 border-amber-300 shadow">
                    <h3 class="font-semibold text-amber-700 text-lg mb-2 flex items-center"><i class="fas fa-search-location ml-2"></i> منهج الاستبطان</h3>
                    <p class="text-gray-700 mb-2 text-lg">أكدت على أن منهج <span class="highlight">الاستبطان أو التأمل الباطني</span> هو المنهج المناسب لدراسة الخبرة الداخلية الشعورية المباشرة، وتحليلها إلى عناصرها الأولية.</p>
                    <div class="example-box border-l-4 border-teal-400 bg-teal-50 mt-2 p-3">
                        <h4 class="font-semibold text-teal-700 mb-1 flex items-center"><i class="fas fa-user-astronaut ml-2"></i> مثال تطبيقي:</h4>
                        <p class="text-gray-700 text-md">لو أن شخصًا يشعر بالقلق والتوتر بسبب مشكلة ما في حياته، فإن الطريقة المناسبة لدراسة وفهم هذه الخبرة الداخلية الشعورية هي منهج الاستبطان. يمكن للشخص أن يجلس في هدوء ويتأمل مشاعره الداخلية، ويحاول تحليلها إلى عناصرها الأساسية؛ فقد يدرك أن قلقه ناتج عن خوفه من الفشل، أو شعوره بعدم الأمان، أو قلة ثقته بنفسه، أو توقعه لردود فعل سلبية من الآخرين.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="المدرسة السلوكية" data-slide-category="مدارس علم النفس">
            <div class="slide-header bg-gradient-to-br from-red-500 via-rose-500 to-pink-600">
                <h1 class="text-3xl md:text-4xl font-bold">المدرسة السلوكية</h1>
                <p class="mt-2 opacity-90 text-lg">دراسة السلوك الملاحظ والقابل للقياس</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-rose-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-running text-rose-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg">أبرز أعلامها «<span class="highlight">واطسون</span>».</p>
                        <p class="text-gray-800 leading-relaxed mt-1 text-lg">نظرت إلى علم النفس على أنه <span class="highlight">علم السلوك الذي يمكن ملاحظته وقياسه</span>.</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-300 hover:shadow-md transition-shadow">
                        <h3 class="font-bold text-xl text-red-700 mb-2 flex items-center"><i class="fas fa-bullseye ml-2"></i> موضوع الدراسة</h3>
                        <p class="text-gray-700 text-lg">ركزت على <span class="highlight">السلوك</span> بوصفه موضوعًا لعلم النفس وليس على الشعور.</p>
                    </div>
                    <div class="p-4 bg-pink-50 rounded-lg border-l-4 border-pink-300 hover:shadow-md transition-shadow">
                        <h3 class="font-bold text-xl text-pink-700 mb-2 flex items-center"><i class="fas fa-binoculars ml-2"></i> المنهج العلمي</h3>
                        <p class="text-gray-700 text-lg">ركزت على <span class="highlight">الملاحظة الموضوعية الخارجية</span> باعتبارها منهجًا أو طريقة لدراسة السلوك، بدلا من الاستبطان الذي يعتمد على الملاحظة الذاتية الداخلية.</p>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-red-50 to-pink-50 p-4 rounded-lg border-l-4 border-red-200 shadow">
                    <h3 class="font-semibold text-red-700 text-lg mb-2 flex items-center"><i class="fas fa-child ml-2"></i> تجربة واطسون الشهيرة</h3>
                    <p class="text-gray-700 text-lg">أجرى واطسون تجربة "ألبرت الصغير" حيث أثبت إمكانية تكييف السلوك (الخوف) من خلال التجربة والتعلم الشرطي.</p>
                </div>
            </div>
        </div>

        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="التحليل النفسي" data-slide-category="مدارس علم النفس">
            <div class="slide-header bg-gradient-to-br from-violet-600 via-purple-600 to-fuchsia-500">
                <h1 class="text-3xl md:text-4xl font-bold">مدرسة التحليل النفسي</h1>
                <p class="mt-2 opacity-90 text-lg">استكشاف الدوافع اللاشعورية</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-purple-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-brain text-purple-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg">مؤسسها «<span class="highlight">فرويد</span>».</p>
                        <p class="text-gray-800 leading-relaxed mt-1 text-lg">أكدت أثر <span class="highlight">العوامل والدوافع اللاشعورية</span> في سلوك الفرد.</p>
                    </div>
                </div>
                <div class="mb-6 p-4 bg-violet-50 rounded-lg border-l-4 border-violet-300">
                    <h3 class="font-bold text-xl text-violet-700 mb-2 flex items-center"><i class="fas fa-user-secret ml-2"></i> الدوافع اللاشعورية</h3>
                    <p class="text-gray-700 mb-3 text-lg">ترى أن ما يحكم السلوك الظاهري للفرد ويوجهه هو <span class="highlight">قوى داخلية</span>، و<span class="highlight">غرائز بدائية</span>، و<span class="highlight">دوافع لا شعورية</span>.</p>
                    <div class="space-y-2">
                        <div class="example-box text-sm"><p><i class="fas fa-shield-alt ml-1 text-purple-500"></i> الخوف من الفشل يحفز الشخص على تجنب المخاطر بسبب غريزة الحفاظ على الذات.</p></div>
                        <div class="example-box text-sm"><p><i class="fas fa-trophy ml-1 text-yellow-500"></i> الطموح الشخصي يدفع الفرد للعمل بجد لتحقيق النجاح دون وعي كامل للدوافع العميقة.</p></div>
                        <div class="example-box text-sm"><p><i class="fas fa-users-slash ml-1 text-red-500"></i> القلق الاجتماعي يجعل الشخص يتجنب المناسبات الاجتماعية نتيجة لدوافع لا شعورية للقبول.</p></div>
                    </div>
                </div>
                <div class="mb-6 p-4 bg-fuchsia-50 rounded-lg border-l-4 border-fuchsia-300">
                    <h3 class="font-bold text-xl text-fuchsia-700 mb-2 flex items-center"><i class="fas fa-baby-carriage ml-2"></i> تأثير الطفولة المبكرة</h3>
                    <p class="text-gray-700 mb-3 text-lg">أكدت على الأثر الخطير لـ<span class="highlight">مرحلة الطفولة المبكرة</span> في تكوين وتشكيل شخصية الفرد.</p>
                    <div class="space-y-2">
                        <div class="example-box text-sm"><p><i class="fas fa-heart ml-1 text-green-500"></i> الأطفال الذين يحصلون على رعاية وحنان كافيين في طفولتهم المبكرة يطوّرون شخصية مستقرة وثقة بالنفس.</p></div>
                        <div class="example-box text-sm"><p><i class="fas fa-sad-tear ml-1 text-red-500"></i> التعرض للتجارب العاطفية السلبية، مثل الإهمال أو العنف في الطفولة المبكرة، يمكن أن يؤدي إلى مشاكل عاطفية وصعوبات في بناء العلاقات.</p></div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 p-4 rounded-lg border-l-4 border-purple-200 shadow">
                    <h3 class="font-semibold text-purple-700 text-lg mb-2 flex items-center"><i class="fas fa-users-cog ml-2"></i> تطور المدرسة</h3>
                    <p class="text-gray-700 text-lg">أضاف تلاميذ فرويد بعض الموضوعات، مثل الاهتمام بالعوامل الثقافية الاجتماعية إلى جانب العوامل اللاشعورية.</p>
                </div>
            </div>
        </div>

        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="مدرسة الجشطلت" data-slide-category="مدارس علم النفس">
            <div class="slide-header bg-gradient-to-br from-emerald-500 via-green-500 to-lime-600">
                <h1 class="text-3xl md:text-4xl font-bold">مدرسة الجشطلت</h1>
                <p class="mt-2 opacity-90 text-lg">الإدراك الكلي: "الكل أكبر من مجموع الأجزاء"</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-green-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-puzzle-piece text-green-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg">من أبرز أعلامها «<span class="highlight">فرتهيمر</span>» و «<span class="highlight">كوفكا</span>» و«<span class="highlight">كوهلر</span>».</p>
                        <p class="text-gray-800 leading-relaxed mt-1 text-lg">أكدت على أن إدراكنا للأشياء يبدأ بإدراك <span class="highlight">الصيغة الكلية</span> لا بإدراك الأجزاء أو العناصر الجزئية.</p>
                    </div>
                </div>
                <div class="mb-6 p-4 bg-emerald-50 rounded-lg border-l-4 border-emerald-300">
                    <h3 class="font-bold text-xl text-emerald-700 mb-2 flex items-center"><i class="fas fa-shapes ml-2"></i> مبدأ الجشطلت الأساسي</h3>
                    <p class="text-gray-700 text-lg">يعني هذا أن <span class="highlight">الكل أكبر من مجموع الأجزاء</span>.</p>
                </div>
                <h4 class="font-bold text-lg text-gray-700 mb-2">أمثلة على الإدراك الكلي:</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="example-box"><p><i class="fas fa-user-circle ml-1 text-blue-500"></i> إدراك الوجه باعتباره شيئًا واحدًا وليس مجموعة من العيون والأنف والفم.</p></div>
                    <div class="example-box"><p><i class="fas fa-music ml-1 text-purple-500"></i> إدراك الأغنية باعتبارها كتلة متناغمة وليس مجموعة من النغمات والإيقاعات والكلمات.</p></div>
                    <div class="example-box"><p><i class="fas fa-palette ml-1 text-orange-500"></i> إدراك اللوحة الفنية ككل متكامل وليس مجموعة أشكال وألوان فردية.</p></div>
                    <div class="example-box"><p><i class="fas fa-comment-dots ml-1 text-teal-500"></i> فهم معنى الجملة ككل وليس كمجموعة معاني كلمات منفصلة.</p></div>
                </div>
            </div>
        </div>

        <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="المدرسة المعرفية" data-slide-category="مدارس علم النفس" id="schools-of-psychology-end">
            <div class="slide-header bg-gradient-to-br from-sky-500 via-blue-600 to-indigo-600">
                <h1 class="text-3xl md:text-4xl font-bold">المدرسة المعرفية</h1>
                <p class="mt-2 opacity-90 text-lg">دور العمليات العقلية في السلوك</p>
            </div>
            <div class="slide-content">
                <div class="flex items-start mb-6 p-4 bg-gray-50 rounded-lg">
                    <div class="bg-blue-100 p-3 rounded-full ml-4 shadow"> <i class="fas fa-cogs text-blue-600 text-2xl"></i> </div>
                    <div>
                        <p class="text-gray-800 leading-relaxed text-lg">من أبرز أعلامها «<span class="highlight">سكنر</span>»، و«<span class="highlight">إستيرنبرج</span>»، و «<span class="highlight">دونالد نورمان</span>»، و«<span class="highlight">أوزبل</span>».</p>
                        <p class="text-gray-800 leading-relaxed mt-1 text-lg">أكدت على وجود العديد من <span class="highlight">العمليات المعرفية العقلية</span> التي تتوسط المثير والاستجابة.</p>
                    </div>
                </div>
                <div class="mb-6 p-4 bg-sky-50 rounded-lg border-l-4 border-sky-300">
                    <h3 class="font-bold text-xl text-sky-700 mb-3 flex items-center"><i class="fas fa-brain ml-2"></i> مبادئ المدرسة المعرفية:</h3>
                    <ul class="space-y-3 text-gray-700 icon-list text-lg">
                        <li><i class="fas fa-exchange-alt text-xs text-sky-500"></i><span>السلوك الإنساني فيها ليس مجرد استجابة بسيطة لمنبهات بيئية، وإنما هناك العديد من <span class="highlight">العمليات الإدراكية والانتباهية</span> التي يتضمنها.</span></li>
                        <li><i class="fas fa-search text-xs text-sky-500"></i><span>استخدم أصحاب المدرسة المعرفية <span class="highlight">المنهج الموضوعي</span> في فهم العمليات المعرفية وأسس تكوين المعلومات.</span></li>
                    </ul>
                </div>
                <h4 class="font-bold text-lg text-gray-700 mb-2">أمثلة تطبيقية:</h4>
                <div class="space-y-3">
                    <div class="example-box"><p><i class="fas fa-tv ml-1 text-blue-500"></i> عندما يرى شخص إعلانًا تجاريًا، يقوم بمعالجة المعلومات، يقيم حاجته للمنتج، يقارنه بغيره، ثم يقرر الشراء.</p></div>
                    <div class="example-box"><p><i class="fas fa-user-graduate ml-1 text-green-500"></i> عندما يسمع طالب محاضرة، يركز انتباهه، يربط المعلومات الجديدة بما يعرفه، يدوّن ملاحظات، ويطرح أسئلة.</p></div>
                    <div class="example-box"><p><i class="fas fa-fire-extinguisher ml-1 text-red-500"></i> عند سماع إنذار حريق، يفكر الشخص (هل هو حقيقي؟)، يتذكر مخارج الطوارئ، ويقرر أي طريق يسلك.</p></div>
                </div>
            </div>
        </div>
        </div>

    <script>
        const GEMINI_API_KEY = "AIzaSyChIOxuTAmBVpUddd3u77335X-GjnSn12Y"; // Replace with your actual API key if needed
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

        const questionBank = [
            // --- المراحل التاريخية ---
            { id: "qb_hist_01", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفسيولوجية", text: "ساهم هذا العالم في مجال الطبيعة النفسية. الطبيعة النفسية هي أحد فروع علم النفس الذي يدرس العلاقة بين المثيرات الحسية والاستجابات أو ردود الأفعال الناتجة عنها. تناقش المقولة السابقة أحد أعمال...", options: [{text:"ويليام جيمس"}, {text:"إدوارد تيتشنر"}, {text:"جون واطسون"}, {text:"فيلهلم فونت", isCorrect:true}] },
            { id: "qb_hist_02", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "مرحلة الاستقلالية", text: "لم تَعُد التأمُّلات الفلسفية كافية لمعرفة النفس البشرية؛ ولذلك اتجه العلماء إلى استخدام الوسائل العلمية الدقيقة، كالملاحظة والتجريب والقياس، للتوصُّل إلى نتائج يُمكِن اعتمادها بدرجة عالية من الصدق والثقة. تُشير العبارة السابقة إلى إحدى مراحل تطوُّر علم النفس، وهي المرحلة...", options: [{text:"الفسيولوجية"}, {text:"الفلسفية"}, {text:"الاستقلالية", isCorrect:true}, {text:"الانتقالية"}] },
            { id: "qb_hist_03", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفسيولوجية", text: "انتقل علماء النفس إلى هذه المرحلة من مراحل التطوُّر؛ لأنهم أرادوا أن يستفيدوا من المنهجيات العلمية التي كانت مُستخدمة في العلوم التطبيقية. تُشير العبارة السابقة إلى إحدى مراحل تطوُّر علم النفس، وهي...", options: [{text:"المرحلة الفلسفية"}, {text:"المرحلة النفسية"}, {text:"المرحلة الفسيولوجية", isCorrect:true}, {text:"مرحلة الاستقلال"}] },
            { id: "qb_hist_04", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفلسفية", text: "في هذه المرحلة من التطوُّر، اهتم علم النفس بدراسة ماهية النفس ومعرفة حقيقتها. تصف العبارة السابقة إحدى مراحل تطوُّر علم النفس، وهي...", options: [{text:"المرحلة السلوكية"}, {text:"المرحلة النفسية"}, {text:"مرحلة الاستقلال"}, {text:"المرحلة الفلسفية", isCorrect:true}] },
            { id: "qb_hist_05", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفسيولوجية", text: "بحث بافلوف في الوظائف العقلية وعلاقتها بالمحفزات البيئية، كالتفاعلات العضوية في الجسم وارتباطها بردود الفعل السلوكية للفرد. تعكس هذه الدراسة ظهور علم النفس في المرحلة...", options: [{text:"الفسيولوجية", isCorrect:true}, {text:"الاستقلالية"}, {text:"الفلسفية"}, {text:"التأملية"}] },
            { id: "qb_hist_06", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "زمن الرجع (فونت)", text: "في إحدى التجارب النفسية، تم توجيه مجموعة من المشاركين للاستجابة لمحفِّز سمعي محدَّد عن طريق الضغط على زر معين، ومع تكرار هذه التجربة، لوحظ تحسُّن ملحوظ في سرعة استجابة المشاركين وتفاعُلهم مع المحفز الصوتي. توضح تلك التجربة أحد محاور فونت في المعمل، وهو...", options: [{text:"زمن الرجع", isCorrect:true}, {text:"الطبيعة النفسية"}, {text:"الإدراك الحسي"}, {text:"الإدراك العقلي"}] },
            { id: "qb_hist_07", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "زمن الرجع (فونت)", text: "أجرى فونت في معمله تجارب استهدفت الكشف عن كفاءة وسرعة أداء العمليات والوظائف العقلية العليا؛ حيث أعطى المفحوص تعليمات أن منبهًا محددًا، كالضوء الأحمر، سيعرض أمامه، ومهمته أن يستجيب بأسرع ما يمكن، كأن يضغط على زر أو مفتاح معين يوقف به الضوء. تُعَد العبارة السابقة تطبيقًا لأحد المحاور التي تضمَّنتها دراسات فونت، وهو...", options: [{text:"زمن الرجع", isCorrect:true}, {text:"الوعي والشعور"}, {text:"الطبيعة النفسية"}, {text:"الإدراك الحسي"}] },
            { id: "qb_hist_08", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفلسفية", text: "يرى الغزالي أن الروح كيان معنوي مستقل، وهي مصدر الطاقة الدافعة للبشر. يتفق القول السابق مع إحدى مراحل علم النفس، وهي المرحلة...", options: [{text:"الفلسفية", isCorrect:true}, {text:"الاستقلالية"}, {text:"الاستنباطية"}, {text:"الفسيولوجية"}] },
            { id: "qb_hist_09", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفسيولوجية", text: "تشير نظرية الأنماط الجسدية إلى وجود ارتباط بين شكل جسم الفرد وسماته الشخصية... يشير ما سبق إلى إحدى مراحل علم النفس، وهي المرحلة...", options: [{text:"التأملية"}, {text:"الاستقلالية"}, {text:"الفلسفية"}, {text:"الفسيولوجية", isCorrect:true}] },
            { id: "qb_hist_10", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفسيولوجية", text: "ولهلم فونت هو أحد الرواد الذين ساهموا في تحويل علم النفس إلى هذه المرحلة من مراحل تطوره. تشير العبارة السابقة إلى...", options: [{text:"المرحلة الفلسفية"}, {text:"المرحلة الفسيولوجية", isCorrect:true}, {text:"مرحلة الاستقلال"}, {text:"المرحلة الاجتماعية"}] },
            { id: "qb_hist_11", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "مرحلة الاستقلالية", text: "أكد بعض علماء النفس أن السلوك الظاهر هو الأساس الذي يتم من خلاله قياس وفهم سلوك الإنسان، وكيفية تفاعله مع بيئته الداخلية والخارجية. تشير العبارة السابقة إلى إحدى مراحل نشأة علم النفس، وهي المرحلة...", options: [{text:"التأملية"}, {text:"الفلسفية"}, {text:"الاستقلالية", isCorrect:true}, {text:"الفسيولوجية"}] },
            { id: "qb_hist_12", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "مرحلة الاستقلالية", text: "السلوك الإنساني ظاهرة معقَّدة... يمكن القول إن السلوك الإنساني يخضع لمبادئ وقوانين مثل الظواهر الطبيعية. تشير تلك الفكرة إلى طبيعة الدراسة في علم النفس في المرحلة...", options: [{text:"الفسيولوجية"}, {text:"الفلسفية"}, {text:"الوضعية"}, {text:"الاستقلالية", isCorrect:true}] },
            { id: "qb_hist_13", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفسيولوجية", text: "في عام ١٨٧٩، أنشأ هذا العالِم أول معمل لعلم النفس التجريبي في العالَم بجامعة ليبزج الألمانية. تُشير هذه العبارة إلى...", options: [{text:"ولهلم فونت", isCorrect:true}, {text:"إميل دوركايم"}, {text:"هربرت سبنسر"}, {text:"سيجموند فرويد"}] }, 
            { id: "qb_hist_14", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "المرحلة الفسيولوجية", text: "أوضحت الدراسات أن المخيخ... يؤثر بشكل كبير في التناسق الحركي والتوازن... تعكس هذه الدراسة ظهور علم النفس في المرحلة...", options: [{text:"التأملية"}, {text:"الاستقلالية"}, {text:"الفلسفية"}, {text:"الفسيولوجية", isCorrect:true}] },
            { id: "qb_hist_15", slideTitle: "سؤال", category: "مراحل تاريخية", topic: "مرحلة الاستقلالية", text: "في هذه المرحلة من مراحل تطور علم النفس، عارض علماء النفس ارتباط علم النفس بعلم الفيسولوجي وعلم البيولوجي. ونظروا إليه باعتباره علمًا قائمًا بذاته. تشير العبارة السابقة إلى إحدى مراحل تطور علم النفس، وهي...", options: [{text:"المرحلة الاجتماعية"}, {text:"المرحلة الفلسفية"}, {text:"مرحلة الاستقلال", isCorrect:true}, {text:"المرحلة الفسيولوجية"}] },

            // --- مدارس علم النفس ---
            { id: "qb_school_01", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "التحليل النفسي", text: "يقول أحد العلماء: «إذا أردت أن تعرف سبب العلة في مريض فيجب أن تُسلِّط الضوء على تاريخه؛ حتى تظهر الحقائق واضحةً تحت مجهر الماضي». نستخلص من القول السابق موضوع إحدى مدارس علم النفس الحديث، وهي...", options: [{text:"مدرسة التحليل النفسي", isCorrect:true}, {text:"المدرسة البنائية"}, {text:"المدرسة المعرفية"}, {text:"المدرسة السلوكية"}] },
            { id: "qb_school_02", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "البنائية", text: "يجب أن يُحلِّل علماء النفس العمليات العقلية الواعية إلى عناصرها الأولية من إحساسات وإدراكات وصور ذهنية، واكتشاف الروابط بينها، كما يُحلِّل الكيميائي الماء إلى هيدروجين وأكسجين. تُمثِّل العبارة السابقة إحدى مدارس علم النفس، وهي...", options: [{text:"المدرسة السلوكية"}, {text:"مدرسة الجشطلت"}, {text:"المدرسة البنائية", isCorrect:true}, {text:"مدرسة التحليل النفسي"}] },
            { id: "qb_school_03", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "السلوكية", text: "يقول جون واطسون: «يُصنَع الرجال لا يُولَدون … أعطِني الطفل، وسأجعله يتسلَّق... سأجعله سارقًا، أو قاتلًا...». يعبِّر القول السابق عن إحدى مدارس علم النفس، وهي...", options: [{text:"مدرسة التحليل النفسي"}, {text:"المدرسة المعرفية"}, {text:"مدرسة الجشطلت"}, {text:"المدرسة السلوكية", isCorrect:true}] },
            { id: "qb_school_04", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "التحليل النفسي", text: "يعاني أدهم البالغ من العمر ٢٠ عامًا، من خوف غير منطقي من الفئران... كشفت والدته أن أدهم قد عضَّه فأر عندما كان صغيرًا. يُعبِّر الموقف السابق عن...", options: [{text:"المدرسة المعرفية"}, {text:"المدرسة البنائية"}, {text:"المدرسة السلوكية"}, {text:"مدرسة التحليل النفسي", isCorrect:true}] },
            { id: "qb_school_05", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "البنائية", text: "«الخبرات والتجارب الحياتية تُشكِّل قيودًا نفسية لكل إنسان، وهو ما يجعل من الضروري أن يكون الفرد متيقظًا لذاته ومدركًا لها». تُجسِّد العبارة السابقة أفكار إحدى مدارس علم النفس، وهي المدرسة...", options: [{text:"البنائية", isCorrect:true}, {text:"الجشطلتية"}, {text:"المعرفية"}, {text:"السلوكية"}] },
            { id: "qb_school_06", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "التحليل النفسي", text: "قد تجد أن الطريقة التي تتعامل بها مع الأحداث تكشف عن انطباعاتك الشعورية الخفية وتأثيرها في حياتك. تعكس العبارة السابقة أفكار إحدى مدارس علم النفس، وهي...", options: [{text:"المدرسة الجشطلتية"}, {text:"المدرسة المعرفية"}, {text:"المدرسة البنائية"}, {text:"مدرسة التحليل النفسي", isCorrect:true}] },
            { id: "qb_school_07", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "التحليل النفسي", text: "عندما لا يستطيع أحد الأفراد إشباع رغباته العدوانية بشكل مباشر ضد رئيسه في العمل... فإن دوافعه اللاشعورية تدفعه نحو تفريغ غضبه بشكل غير واعٍ على أفراد عائلته... يعكس المثال السابق إحدى مدارس علم النفس، وهي...", options: [{text:"مدرسة التحليل النفسي", isCorrect:true}, {text:"المدرسة المعرفية"}, {text:"مدرسة الجشطلت"}, {text:"المدرسة السلوكية"}] },
            { id: "qb_school_08", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "المعرفية", text: "عندما يتَّخذ الفرد سلوكًا مُعيَّنًا، فإن هذا السلوك لا يُعَدُّ انعكاسًا لعوامل خارجية وحسب، بل يُعَدُّ انعكاسًا لعوامل داخلية أيضًا. تُشِير العبارة السابقة إلى...؛ وهي إحدى مدارس علم النفس.", options: [{text:"مدرسة الجشطلت"}, {text:"المدرسة المعرفية", isCorrect:true}, {text:"المدرسة السلوكية"}, {text:"المدرسة البنائية"}] },
            { id: "qb_school_09", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "الجشطلت", text: "تستند إحدى المدارس إلى فكرة أن العقل البشري يميل إلى تنظيم المعلومات الحِسِّية بشكل منظَّم ومتكامل... تُطبِّق العبارة فِكْر إحدى مدارس علم النفس، وهي...", options: [{text:"مدرسة الجشطلت", isCorrect:true}, {text:"المدرسة المعرفية"}, {text:"المدرسة السلوكية"}, {text:"المدرسة البنائية"}] },
            { id: "qb_school_10", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "البنائية", text: "عرض معلِّمٌ على طلابه لوحة فنية، وبعد أن انتهوا من مشاهدتها طلب منهم اختيار عنوان يُعبِّر عن مشاعرهم تجاهها. يُجسِّد ما سبق أفكار إحدى مدارس علم النفس، وهي المدرسة...", options: [{text:"الجشطلتية"}, {text:"المعرفية"}, {text:"التحليلية"}, {text:"البنائية", isCorrect:true}] },
            { id: "qb_school_11", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "التحليل النفسي", text: "يقرِّر عالِم نفسٍ أن شخصًا يخاف من القطط لأن قطة عضَّتْه عندما كان طفلًا. تُمثِّل العبارة السابقة إحدى مدارس علم النفس، هي...", options: [{text:"المدرسة المعرفية"}, {text:"مدرسة التحليل النفسي", isCorrect:true}, {text:"المدرسة الوظيفية"}, {text:"مدرسة الجشطلت"}] },
            { id: "qb_school_12", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "الجشطلت", text: "كل لاعب في فريق كرة القدم قد يكون موهوبًا بشكل فردي... ولكن عندما يتعاون جميع اللاعبين معًا بوصفهم فريقًا واحدًا، يتحولون من مجموعة من اللاعبين إلى فريق قوي ومنظم. يشير المثال السابق إلى فكر إحدى مدارس علم النفس، وهي...", options: [{text:"مدرسة التحليل النفسي"}, {text:"المدرسة السلوكية"}, {text:"مدرسة الجشطلت", isCorrect:true}, {text:"المدرسة البنائية"}] },
            { id: "qb_school_13", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "البنائية", text: "وجدت إحدى الدراسات أن تجاربنا السابقة تؤثر على حياتنا، لذلك من المهم أن نلاحظ أنفسنا لنفهم كيف تؤثر هذه التجارب علينا. تجسِّد العبارة السابقة أفكار إحدى مدارس علم النفس، وهي المدرسة...", options: [{text:"الجشطلتية"}, {text:"البنائية", isCorrect:true}, {text:"المعرفية"}, {text:"السلوكية"}] },
            { id: "qb_school_14", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "السلوكية", text: "«بتنظيم الأنشطة التعليمية واستخدام أدوات تفاعلية في الفصل، يُمكِن للمعلم توفير بيئة تُشجِّع على المشاركة النشطة، وهو ما يُعزِّز من دقة تقييم استيعاب الطلاب». تشير العبارة السابقة إلى أفكار إحدى مدارس علم النفس، وهي...", options: [{text:"المدرسة البنائية"}, {text:"المدرسة السلوكية", isCorrect:true}, {text:"المدرسة الجشطلتية"}, {text:"مدرسة التحليل النفسي"}] },
            { id: "qb_school_15", slideTitle: "سؤال", category: "مدارس علم النفس", topic: "السلوكية", text: "إذا كان سلوك الأطفال جيدًا في حضور معلِّمهم، فإنهم يَعلَمون أنهم سيُكافَئون بالثناء عليهم. تُشير العبارة السابقة إلى إحدى مدارس علم النفس، وهي...", options: [{text:"المدرسة السلوكية", isCorrect:true}, {text:"المدرسة الإنسانية"}, {text:"المدرسة البنائية"}, {text:"مدرسة التحليل النفسي"}] }
        ];

        const slidesContainer = document.getElementById('slides-container');
        const navThumbnailsContainer = document.getElementById('nav-thumbnails');
        const prevBtnTop = document.getElementById('prev-btn-top');
        const nextBtnTop = document.getElementById('next-btn-top');
        let slides = []; 
        let navThumbnails = []; 
        let currentSlide = 0;
        let studentErrors = { "مراحل تاريخية": 0, "مدارس علم النفس": 0 };
        let adaptiveTestTimerInterval;
        const SWIPE_THRESHOLD = 50; 

        const SECTION_1_CATEGORY = "مراحل تاريخية";
        const SECTION_2_CATEGORY = "مدارس علم النفس";
        const MIN_CORRECT_TO_UNLOCK_SECTION_2 = 3;
        const RELEVANT_QUESTION_COUNT_FOR_UNLOCK = 5;

        let sectionProgress = {
            [SECTION_1_CATEGORY]: {
                recentUniqueAnswers: [], 
                correctInLastUniqueFive: 0,
                section2Unlocked: false 
            },
            [SECTION_2_CATEGORY]: { 
                recentUniqueAnswers: [],
                correctInLastUniqueFive: 0,
            }
        };
      
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createQuestionSlideHTML(questionData, globalSlideIndex) {
            const optionsHTML = shuffleArray([...questionData.options]).map(opt => 
                `<button class="answer-btn bg-white border-2 border-gray-300 rounded-lg p-3 text-right transition duration-150 text-lg ${opt.isCorrect ? 'correct-answer' : ''}" data-answer-value="${opt.text}" data-answer-topic="${questionData.topic || ''}">${opt.text}</button>`
            ).join('');

            const displaySlideTitle = "سؤال"; 

            return `
                <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" data-slide-title="${displaySlideTitle}" data-slide-category="${questionData.category}" data-is-question="true">
                    <div class="slide-header bg-gradient-to-br from-teal-500 via-cyan-500 to-sky-600">
                        <h1 class="text-3xl md:text-4xl font-bold">${displaySlideTitle}</h1>
                        <p class="mt-2 opacity-90 text-lg">اختبر فهمك - ${questionData.category}</p>
                    </div>
                    <div class="slide-content">
                        <div class="question-box" data-question-id="${questionData.id}">
                            <p class="text-gray-800 leading-relaxed mb-5 text-lg" id="question-text-${questionData.id}">${questionData.text}</p>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                ${optionsHTML}
                            </div>
                            <div class="mt-4 hidden" id="feedback-correct-${questionData.id}"> <div class="bg-green-100 border-l-4 border-green-500 p-4 rounded"> <div class="flex"> <div class="flex-shrink-0"><i class="fas fa-check-circle text-green-600 text-xl"></i></div> <div class="mr-3"><p class="text-md text-green-700 font-medium">إجابة صحيحة!</p></div> </div> </div> </div>
                            <div class="mt-4 hidden" id="feedback-incorrect-${questionData.id}"> <div class="bg-red-100 border-l-4 border-red-500 p-4 rounded"> <div class="flex"> <div class="flex-shrink-0"><i class="fas fa-times-circle text-red-600 text-xl"></i></div> <div class="mr-3"><p class="text-md text-red-700 font-medium">إجابة غير صحيحة. الإجابة الصحيحة هي: <span class="font-bold" id="correct-answer-text-${questionData.id}"></span></p></div> </div> </div> </div>
                            <div id="ai-feedback-${questionData.id}" class="ai-feedback hidden"></div>
                            <div id="loading-${questionData.id}" class="loading-spinner hidden"></div>
                             <button class="next-slide-btn bg-blue-500 text-white hover:bg-blue-600" id="next-question-btn-${questionData.id}">السؤال التالي</button>
                        </div>
                        <div class="flex justify-center mt-6"> <button id="check-answer-${questionData.id}" class="bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700 transition duration-150 text-lg font-semibold flex items-center shadow-md active:scale-95"><i class="fas fa-question-circle ml-2"></i>التحقق من الإجابة</button> </div>
                    </div>
                </div>
            `;
        }
        
        function insertSlidesAfterElement(newSlidesHTMLArray, targetElementId) {
            const targetElement = document.getElementById(targetElementId);
            if (targetElement) {
                let currentElement = targetElement;
                newSlidesHTMLArray.forEach(slideHTML => {
                    currentElement.insertAdjacentHTML('afterend', slideHTML);
                    currentElement = currentElement.nextElementSibling; 
                });
            } else {
                console.error("Target element for inserting slides not found:", targetElementId);
            }
        }

        function updateThumbnailLockStatus() {
            navThumbnails.forEach((thumbnail, index) => {
                const slide = slides[index];
                const category = slide.dataset.slideCategory;
                if (category === SECTION_2_CATEGORY && !sectionProgress[SECTION_1_CATEGORY].section2Unlocked) {
                    thumbnail.classList.add('locked');
                    thumbnail.title = `${thumbnail.title} (مغلق - أكمل القسم السابق لفتحه)`;
                } else {
                    thumbnail.classList.remove('locked');
                    // Remove the locked part of the title if it was added
                    thumbnail.title = thumbnail.title.replace(/ \(مغلق - أكمل القسم السابق لفتحه\)/, '');
                }
            });
        }

        function initializeSlidesAndNavigation() {
            slides = Array.from(document.querySelectorAll('#slides-container .slide')); 
            navThumbnailsContainer.innerHTML = ''; 

            slides.forEach((slide, index) => {
                const thumbnail = document.createElement('button');
                thumbnail.className = 'nav-thumbnail';
                const slideTitle = slide.dataset.slideTitle || `شريحة ${index + 1}`;
                thumbnail.dataset.slide = index;
                thumbnail.title = slideTitle; // Tooltip with original slide title

                let iconHTML = '';
                // Determine slide type for icon
                if (slide.dataset.isQuestion === "true" || slide.dataset.slideTitle === "سؤال" || slide.dataset.slideTitle === "اختبار تكيفي") {
                    iconHTML = '<i class="fas fa-question-circle text-xl"></i>'; // Question icon
                } else {
                    iconHTML = '<i class="fas fa-file-alt text-xl"></i>'; // Explanation icon
                }
                thumbnail.innerHTML = iconHTML;
                
                if(index === currentSlide) thumbnail.classList.add('active');
                
                thumbnail.addEventListener('click', () => {
                    goToSlide(index);
                });
                navThumbnailsContainer.appendChild(thumbnail);
            });
            navThumbnails = Array.from(navThumbnailsContainer.querySelectorAll('.nav-thumbnail'));
            updateNavButtons();
            updateThumbnailLockStatus(); 
            setupAllQuestionSlides(); 
        }


        function updateNavButtons() {
            if (!prevBtnTop || !nextBtnTop || navThumbnails.length === 0) return;
            prevBtnTop.disabled = currentSlide === 0;
            nextBtnTop.disabled = currentSlide === slides.length - 1;
            prevBtnTop.classList.toggle('opacity-50', currentSlide === 0);
            prevBtnTop.classList.toggle('cursor-not-allowed', currentSlide === 0);
            nextBtnTop.classList.toggle('opacity-50', currentSlide === slides.length - 1);
            nextBtnTop.classList.toggle('cursor-not-allowed', currentSlide === slides.length - 1);

            const activeThumbnail = navThumbnails[currentSlide];
            if (activeThumbnail) {
                activeThumbnail.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }
        
        function showCustomAlert(message, type = 'error') {
            const existingAlert = document.querySelector('.custom-alert-message');
            if (existingAlert) existingAlert.remove();

            const alertDiv = document.createElement('div');
            alertDiv.classList.add('custom-alert-message'); 
            let bgColor, textColor, borderColor;
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-100'; textColor = 'text-green-700'; borderColor = 'border-green-500'; break;
                case 'info':
                    bgColor = 'bg-blue-100'; textColor = 'text-blue-700'; borderColor = 'border-blue-500'; break;
                case 'error':
                default:
                    bgColor = 'bg-red-100'; textColor = 'text-red-700'; borderColor = 'border-red-500'; break;
            }
            alertDiv.innerHTML = `<div class="${bgColor} ${textColor} border-l-4 ${borderColor} p-4 rounded-md shadow-md">
                                    <p class="font-semibold">${message}</p>
                                 </div>`;
            alertDiv.style.cssText = `position:fixed; top:80px; left:50%; transform:translateX(-50%); z-index: 2000; min-width: 300px; text-align: center;`;
            document.body.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 4000);
        }


        function goToSlide(slideIndex) {
            if (slideIndex < 0 || slideIndex >= slides.length) return;

            const targetSlide = slides[slideIndex];
            const targetCategory = targetSlide.dataset.slideCategory;

            if (targetCategory === SECTION_2_CATEGORY && !sectionProgress[SECTION_1_CATEGORY].section2Unlocked) {
                showCustomAlert(`يجب عليك إجابة ${MIN_CORRECT_TO_UNLOCK_SECTION_2} أسئلة بشكل صحيح من آخر ${RELEVANT_QUESTION_COUNT_FOR_UNLOCK} أسئلة فريدة أجبت عليها في قسم '${SECTION_1_CATEGORY}' لفتح هذا القسم.`);
                return; 
            }

            if (slides[currentSlide]) slides[currentSlide].classList.remove('active');
            if (navThumbnails[currentSlide]) navThumbnails[currentSlide].classList.remove('active');
            
            currentSlide = slideIndex;
            
            if (slides[currentSlide]) slides[currentSlide].classList.add('active');
            if (navThumbnails[currentSlide]) navThumbnails[currentSlide].classList.add('active');
            
            updateNavButtons();
            updateThumbnailLockStatus(); 
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        async function getAIFeedback(questionId, questionText, userAnswer, isCorrect, correctAnswerText) {
            const feedbackDiv = document.getElementById(`ai-feedback-${questionId}`);
            const loadingSpinner = document.getElementById(`loading-${questionId}`);
            if (!feedbackDiv || !loadingSpinner) return;

            loadingSpinner.classList.remove('hidden');
            feedbackDiv.classList.add('hidden');
            feedbackDiv.innerHTML = ''; 

            let prompt;
            if (isCorrect) {
                prompt = `السؤال: "${questionText}"\nإجابة الطالب: "${userAnswer}" (صحيحة).\nقدم تغذية راجعة إيجابية وموجزة جداً (سطر واحد فقط لا يتجاوز 15 كلمة) للطالب تشجعه. اجعل الرد باللغة العربية الفصحى وبأسلوب تعليمي وودي.`;
            } else {
                prompt = `السؤال: "${questionText}"\nإجابة الطالب: "${userAnswer}" (خاطئة).\nالإجابة الصحيحة هي: "${correctAnswerText}".\nقدم تغذية راجعة بناءة وموجزة جداً (سطر واحد فقط لا يتجاوز 15 كلمة) للطالب تشرح لماذا إجابته خاطئة بشكل مختصر. اجعل الرد باللغة العربية الفصحى وبأسلوب تعليمي وودي.`;
            }

            try {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('API Error Details:', errorData);
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                    const aiText = result.candidates[0].content.parts[0].text;
                    feedbackDiv.innerHTML = `<p><strong>تغذية راجعة إضافية:</strong></p><p>${aiText.replace(/\n/g, '<br>')}</p>`;
                } else if (result.candidates && result.candidates[0]?.finishReason) {
                     console.warn('AI Warning: Finish reason -', result.candidates[0].finishReason, result.candidates[0].safetyRatings);
                     feedbackDiv.innerHTML = '<p>تم إنشاء جزء من التغذية الراجعة. قد يكون السبب يتعلق بسياسات المحتوى.</p>';
                }
                else {
                    console.error('Unexpected API response structure:', result);
                    feedbackDiv.innerHTML = '<p>عفواً، لم نتمكن من الحصول على تغذية راجعة إضافية حالياً.</p>';
                }
            } catch (error) {
                console.error('Error fetching AI feedback:', error);
                feedbackDiv.innerHTML = `<p>حدث خطأ أثناء محاولة الحصول على التغذية الراجعة الإضافية: ${error.message}</p>`;
            } finally {
                loadingSpinner.classList.add('hidden');
                feedbackDiv.classList.remove('hidden');
            }
        }

        function setupAllQuestionSlides() {
            document.querySelectorAll('.question-box').forEach(questionContainer => {
                const questionId = questionContainer.dataset.questionId;
                if (!questionId) return; 

                const checkBtn = document.getElementById(`check-answer-${questionId}`);
                const correctAnswerFeedbackDiv = document.getElementById(`feedback-correct-${questionId}`);
                const incorrectAnswerFeedbackDiv = document.getElementById(`feedback-incorrect-${questionId}`);
                const correctAnswerTextSpan = document.getElementById(`correct-answer-text-${questionId}`);
                const answerButtons = questionContainer.querySelectorAll('.answer-btn');
                const questionTextElement = document.getElementById(`question-text-${questionId}`);
                const nextQuestionBtn = document.getElementById(`next-question-btn-${questionId}`);
                let selectedButton = null;

                answerButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (checkBtn.disabled) return; 

                        answerButtons.forEach(b => b.classList.remove('selected-temp', 'correct', 'incorrect'));
                        this.classList.add('selected-temp');
                        selectedButton = this;
                        
                        if(correctAnswerFeedbackDiv) correctAnswerFeedbackDiv.classList.add('hidden');
                        if(incorrectAnswerFeedbackDiv) incorrectAnswerFeedbackDiv.classList.add('hidden');
                        const aiFeedbackDiv = document.getElementById(`ai-feedback-${questionId}`);
                        if(aiFeedbackDiv) aiFeedbackDiv.classList.add('hidden');
                        const loadingSpinner = document.getElementById(`loading-${questionId}`);
                        if(loadingSpinner) loadingSpinner.classList.add('hidden');
                        if(nextQuestionBtn) nextQuestionBtn.style.display = 'none'; 
                    });
                });

                if (checkBtn) {
                    const newCheckBtn = checkBtn.cloneNode(true); 
                    checkBtn.parentNode.replaceChild(newCheckBtn, checkBtn);

                    newCheckBtn.addEventListener('click', function() {
                        if (!selectedButton) {
                            showCustomAlert("الرجاء اختيار إجابة أولاً.", 'info');
                            return;
                        }
                        
                        answerButtons.forEach(b => b.classList.remove('selected-temp'));
                        const isCorrect = selectedButton.classList.contains('correct-answer');
                        const correctAnswerButton = questionContainer.querySelector('.answer-btn.correct-answer');
                        const correctAnswerValue = correctAnswerButton ? correctAnswerButton.dataset.answerValue : "غير محدد";
                        const questionText = questionTextElement ? questionTextElement.innerText.trim() : "نص السؤال غير موجود";
                        const userAnswerValue = selectedButton.dataset.answerValue;
                        
                        const currentQuestionSlideElement = slides[currentSlide]; 
                        const questionCategory = currentQuestionSlideElement.dataset.slideCategory;

                        if (isCorrect) {
                            selectedButton.classList.add('correct');
                            if(correctAnswerFeedbackDiv) correctAnswerFeedbackDiv.classList.remove('hidden');
                            if(incorrectAnswerFeedbackDiv) incorrectAnswerFeedbackDiv.classList.add('hidden');
                        } else {
                            selectedButton.classList.add('incorrect');
                            if (correctAnswerButton) correctAnswerButton.classList.add('correct');
                            if(incorrectAnswerFeedbackDiv) {
                                if(correctAnswerTextSpan) correctAnswerTextSpan.textContent = correctAnswerValue;
                                incorrectAnswerFeedbackDiv.classList.remove('hidden');
                            }
                            if(correctAnswerFeedbackDiv) correctAnswerFeedbackDiv.classList.add('hidden');
                            if (questionCategory && studentErrors.hasOwnProperty(questionCategory)) {
                                studentErrors[questionCategory]++;
                            }
                        }
                        
                        if (questionCategory === SECTION_1_CATEGORY) {
                            const currentProgress = sectionProgress[SECTION_1_CATEGORY];
                            currentProgress.recentUniqueAnswers = currentProgress.recentUniqueAnswers.filter(ans => ans.id !== questionId);
                            currentProgress.recentUniqueAnswers.push({ id: questionId, correct: isCorrect });
                            if (currentProgress.recentUniqueAnswers.length > RELEVANT_QUESTION_COUNT_FOR_UNLOCK) {
                                currentProgress.recentUniqueAnswers.shift();
                            }
                            currentProgress.correctInLastUniqueFive = currentProgress.recentUniqueAnswers.filter(ans => ans.correct).length;

                            if (!currentProgress.section2Unlocked && currentProgress.correctInLastUniqueFive >= MIN_CORRECT_TO_UNLOCK_SECTION_2) {
                                currentProgress.section2Unlocked = true;
                                showCustomAlert(`تهانينا! لقد تم فتح قسم '${SECTION_2_CATEGORY}'. يمكنك الآن تصفح شرائحه.`, 'success');
                                updateThumbnailLockStatus(); 
                            }
                        }

                        getAIFeedback(questionId, questionText, userAnswerValue, isCorrect, correctAnswerValue);
                        newCheckBtn.disabled = true; 
                        newCheckBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        if(nextQuestionBtn) nextQuestionBtn.style.display = 'block'; 
                    });
                }
                if (nextQuestionBtn) {
                     nextQuestionBtn.addEventListener('click', () => {
                        if (currentSlide < slides.length - 1) {
                            goToSlide(currentSlide + 1);
                        } else {
                            const adaptiveTestTrigger = document.getElementById('trigger-adaptive-test-btn');
                            if (adaptiveTestTrigger && !adaptiveTestTrigger.parentElement.closest('.slide.hidden')) { 
                                adaptiveTestTrigger.click();
                            } else {
                                showCustomAlert("لقد وصلت إلى نهاية الأسئلة في هذا القسم.", "info");
                            }
                        }
                    });
                }
            });
        }

        function createAdaptiveTestSlide(questions) {
            const adaptiveQuestionsHTML = questions.map((q, i) => {
                const optionsHTML = shuffleArray([...q.options]).map(opt => 
                    `<button class="answer-btn bg-white border-2 border-gray-300 rounded-lg p-3 text-right transition duration-150 text-lg ${opt.isCorrect ? 'correct-answer' : ''}" data-answer-value="${opt.text}">${opt.text}</button>`
                ).join('');
                return `
                    <div class="question-box mb-6" data-question-id="adapt_${q.id}">
                        <p class="text-gray-800 leading-relaxed mb-3 text-lg">${i + 1}. ${q.text}</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            ${optionsHTML}
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <div class="slide bg-white rounded-xl shadow-2xl overflow-hidden" id="adaptive-test-slide-content" data-slide-title="اختبار تكيفي" data-slide-category="اختبار">
                    <div class="slide-header bg-gradient-to-br from-red-500 via-rose-600 to-pink-600">
                        <h1 class="text-3xl md:text-4xl font-bold">الاختبار التكيفي</h1>
                        <p class="mt-2 opacity-90 text-lg">ركز على هذه الأسئلة لتعزيز فهمك.</p>
                    </div>
                    <div class="slide-content">
                        <div id="adaptive-test-timer" class="adaptive-test-timer">الوقت المتبقي: 20:00</div>
                        <div id="adaptive-questions-container">
                            ${adaptiveQuestionsHTML}
                        </div>
                        <div class="flex justify-center mt-6">
                            <button id="submit-adaptive-test" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition duration-150 text-lg font-semibold flex items-center shadow-md active:scale-95">
                                <i class="fas fa-check-double ml-2"></i>إنهاء الاختبار و عرض النتيجة
                            </button>
                        </div>
                        <div id="adaptive-test-results-container" class="adaptive-test-results hidden"></div>
                    </div>
                </div>
            `;
        }

        function prepareAndShowAdaptiveTest() {
            let adaptiveTestQuestionsPool = [...questionBank]; 
            
            const finalAdaptiveTestQuestions = shuffleArray(adaptiveTestQuestionsPool).slice(0, 20); 

            if (finalAdaptiveTestQuestions.length === 0) {
                showCustomAlert("لا توجد أسئلة كافية لإنشاء الاختبار التكيفي حاليًا.", "info");
                return;
            }

            const adaptiveTestSlideHTML = createAdaptiveTestSlide(finalAdaptiveTestQuestions);
            const existingAdaptiveSlide = document.getElementById('adaptive-test-slide-content');
            if (existingAdaptiveSlide) existingAdaptiveSlide.remove(); 
            
            slidesContainer.insertAdjacentHTML('beforeend', adaptiveTestSlideHTML);
            initializeSlidesAndNavigation(); 

            document.querySelectorAll('#adaptive-questions-container .answer-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const parentQuestionBox = this.closest('.question-box');
                    parentQuestionBox.querySelectorAll('.answer-btn').forEach(b => b.classList.remove('selected-temp'));
                    this.classList.add('selected-temp');
                });
            });
            
            const submitBtn = document.getElementById('submit-adaptive-test');
            if(submitBtn) submitBtn.addEventListener('click', () => handleSubmitAdaptiveTest(false));
            
            startAdaptiveTestTimer(20 * 60); 
        }
        
        function startAdaptiveTestTimer(durationInSeconds) {
            const timerDisplay = document.getElementById('adaptive-test-timer');
            if (!timerDisplay) return;
            timerDisplay.classList.remove('hidden'); 
            clearInterval(adaptiveTestTimerInterval); 

            let timer = durationInSeconds;
            adaptiveTestTimerInterval = setInterval(() => {
                let minutes = parseInt(timer / 60, 10);
                let seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                timerDisplay.textContent = `الوقت المتبقي: ${minutes}:${seconds}`;
                
                if (timer < 60 && !timerDisplay.classList.contains('low-time')) { 
                    timerDisplay.classList.add('low-time');
                }

                if (--timer < 0) {
                    clearInterval(adaptiveTestTimerInterval);
                    timerDisplay.textContent = "الوقت انتهى!";
                    handleSubmitAdaptiveTest(true); 
                }
            }, 1000);
        }

        function handleSubmitAdaptiveTest(timeUp = false) {
            clearInterval(adaptiveTestTimerInterval);
            const questionsContainer = document.getElementById('adaptive-questions-container');
            const resultsContainer = document.getElementById('adaptive-test-results-container');
            if (!questionsContainer || !resultsContainer) return;

            let score = 0;
            const adaptiveQuestionBoxes = questionsContainer.querySelectorAll('.question-box');
            const totalQuestions = adaptiveQuestionBoxes.length;

            adaptiveQuestionBoxes.forEach(qBox => {
                const selectedBtn = qBox.querySelector('.answer-btn.selected-temp');
                qBox.querySelectorAll('.answer-btn').forEach(btn => btn.disabled = true); 

                if (selectedBtn) {
                    selectedBtn.classList.remove('selected-temp');
                    if (selectedBtn.classList.contains('correct-answer')) {
                        score++;
                        selectedBtn.classList.add('correct');
                    } else {
                        selectedBtn.classList.add('incorrect');
                        const correctAnswerEl = qBox.querySelector('.answer-btn.correct-answer');
                        if (correctAnswerEl) correctAnswerEl.classList.add('correct');
                    }
                } else { 
                    const correctAnswerEl = qBox.querySelector('.answer-btn.correct-answer');
                    if (correctAnswerEl) correctAnswerEl.classList.add('correct'); 
                }
            });
            
            const percentage = totalQuestions > 0 ? ((score / totalQuestions) * 100).toFixed(1) : 0;
            resultsContainer.innerHTML = `
                <h3 class="text-2xl font-bold mb-3 ${percentage >= 50 ? 'text-green-600' : 'text-red-600'}">
                    ${timeUp ? 'انتهى الوقت! ' : ''}نتيجة الاختبار: ${score} من ${totalQuestions} (${percentage}%)
                </h3>
                <p class="text-lg">
                    ${percentage >= 75 ? 'أداء رائع! استمر في المذاكرة.' : (percentage >= 50 ? 'جيد جداً! يمكنك مراجعة الأجزاء التي أخطأت فيها.' : 'تحتاج إلى المزيد من المراجعة. لا تيأس!')}
                </p>
            `;
            resultsContainer.classList.remove('hidden');
            const submitBtn = document.getElementById('submit-adaptive-test');
            if(submitBtn) {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        let xDown = null;
        let yDown = null;
        const swipeContainer = document.getElementById('slides-container');

        swipeContainer.addEventListener('touchstart', handleTouchStart, { passive: true });
        swipeContainer.addEventListener('touchmove', handleTouchMove, { passive: false }); 
        swipeContainer.addEventListener('touchend', handleTouchEnd, { passive: true });

        function handleTouchStart(evt) {
            const firstTouch = evt.touches[0];
            xDown = firstTouch.clientX;
            yDown = firstTouch.clientY;
        }

        function handleTouchMove(evt) {
            if (!xDown || !yDown) {
                return;
            }
            let xUp = evt.touches[0].clientX;
            let yUp = evt.touches[0].clientY;
            let xDiff = xDown - xUp;
            let yDiff = yDown - yUp;

            if (Math.abs(xDiff) > Math.abs(yDiff)) {
                evt.preventDefault(); 
            }
        }

        function handleTouchEnd(evt) {
            if (!xDown || !yDown) {
                return;
            }
            let xUp = evt.changedTouches[0].clientX;
            let yUp = evt.changedTouches[0].clientY;
            let xDiff = xDown - xUp; 
            let yDiff = yDown - yUp;

            if (Math.abs(xDiff) > Math.abs(yDiff)) { 
                if (Math.abs(xDiff) > SWIPE_THRESHOLD) {
                    if (xDiff > 0) { 
                        if (currentSlide < slides.length - 1) nextBtnTop.click();
                    } else { 
                        if (currentSlide > 0) prevBtnTop.click();
                    }
                }
            }
            xDown = null;
            yDown = null;
        }

        document.addEventListener('DOMContentLoaded', function() {
            const historicalQuestions = shuffleArray(questionBank.filter(q => q.category === SECTION_1_CATEGORY)).slice(0, 10); 
            const historicalQuestionsHTML = historicalQuestions.map((q, i) => createQuestionSlideHTML(q, slidesContainer.children.length + i));
            insertSlidesAfterElement(historicalQuestionsHTML, 'historical-stages-end');

            const schoolQuestions = shuffleArray(questionBank.filter(q => q.category === SECTION_2_CATEGORY)).slice(0, 10); 
            const schoolQuestionsHTML = schoolQuestions.map((q, i) => createQuestionSlideHTML(q, slidesContainer.children.length + i));
            insertSlidesAfterElement(schoolQuestionsHTML, 'schools-of-psychology-end');
            
            const allSlidesAfterInsertion = Array.from(slidesContainer.querySelectorAll('.slide'));
            let lastSchoolQuestionSlide = null;
            for(let i = allSlidesAfterInsertion.length -1; i >=0; i--) {
                if(allSlidesAfterInsertion[i].dataset.slideCategory === SECTION_2_CATEGORY && allSlidesAfterInsertion[i].dataset.isQuestion === "true") {
                    lastSchoolQuestionSlide = allSlidesAfterInsertion[i];
                    break;
                }
            }
            if (!lastSchoolQuestionSlide) {
                lastSchoolQuestionSlide = document.getElementById('schools-of-psychology-end');
            }
            
            if (lastSchoolQuestionSlide) {
                const adaptiveTestTriggerButtonHTML = `
                    <div class="mt-10 flex justify-center">
                        <button id="trigger-adaptive-test-btn" class="bg-purple-600 text-white px-8 py-4 rounded-lg hover:bg-purple-700 transition duration-150 text-xl font-semibold flex items-center shadow-lg active:scale-95">
                            <i class="fas fa-graduation-cap ml-3"></i>بدء الاختبار التكيفي
                        </button>
                    </div>
                `;
                const slideContent = lastSchoolQuestionSlide.querySelector('.slide-content');
                if (slideContent) { 
                    const existingCheckButtonContainer = slideContent.querySelector('.flex.justify-center.mt-6');
                    if (existingCheckButtonContainer) existingCheckButtonContainer.remove();
                    const existingNextQuestionBtn = slideContent.querySelector('.next-slide-btn');
                     if (existingNextQuestionBtn) existingNextQuestionBtn.remove();

                    slideContent.insertAdjacentHTML('beforeend', adaptiveTestTriggerButtonHTML);
                }

                const triggerBtn = document.getElementById('trigger-adaptive-test-btn');
                if (triggerBtn) {
                    triggerBtn.addEventListener('click', () => {
                        prepareAndShowAdaptiveTest();
                        const adaptiveSlide = document.getElementById('adaptive-test-slide-content');
                        if (adaptiveSlide) {
                            const allSlidesArray = Array.from(slidesContainer.querySelectorAll('.slide'));
                            const adaptiveSlideIndex = allSlidesArray.indexOf(adaptiveSlide);
                            if (adaptiveSlideIndex !== -1) {
                                goToSlide(adaptiveSlideIndex);
                            }
                        }
                    });
                }
            }

            initializeSlidesAndNavigation(); 
            
            prevBtnTop.addEventListener('click', () => goToSlide(currentSlide - 1));
            nextBtnTop.addEventListener('click', () => goToSlide(currentSlide + 1));
            document.addEventListener('keydown', (e) => {
                if (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA') return;
                if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') e.preventDefault(); 
                if (e.key === 'ArrowRight' && currentSlide > 0) prevBtnTop.click(); 
                else if (e.key === 'ArrowLeft' && currentSlide < slides.length - 1) nextBtnTop.click(); 
            });
        });

    </script>
</body>
</html>
